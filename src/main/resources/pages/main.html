<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>{{title}}</title>

    <link rel="apple-touch-icon" href="{{precacheUrl}}/icons/icon.png">
    <link rel="icon" href="{{precacheUrl}}/icons/icon.png">

    <link rel="manifest" href="{{baseUrl}}/manifest.json">
    <link rel="mask-icon" href="{{precacheUrl}}/icons/safari-pinned-tab.svg" color="#f53d3d">
    <meta name="theme-color" content="{{themeColor}}">
    <meta name="msapplication-config" content="{{baseUrl}}/browserconfig.xml" />
    <meta name="msapplication-TileColor" content="{{themeColor}}">

    <script type="text/javascript" src="{{precacheUrl}}/js/material.min.js" async></script>
    <script type="text/javascript" src="{{precacheUrl}}/bundle.js" async></script>
    {{{styles}}}

</head>

<body>
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">

    <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
            <!-- Title -->
            <span class="mdl-layout-title">{{title}}</span>
            <!-- Add spacer, to align navigation to the right -->
            <div class="mdl-layout-spacer"></div>
            <!-- Navigation. We hide it in small screens. -->
            <nav class="mdl-navigation mdl-layout--large-screen-only">
                <a class="mdl-navigation__link" href="{{baseUrl}}"><b>Home</b></a>
                <a class="mdl-navigation__link" href="{{baseUrl}}/about">About</a>
                <a class="mdl-navigation__link" href="{{baseUrl}}/contact">Contact</a>
            </nav>
        </div>
    </header>
    <div class="mdl-layout__drawer">
        <span class="mdl-layout-title">{{title}}</span>
        <nav class="mdl-navigation">
            <a class="mdl-navigation__link" href="{{baseUrl}}"><b>Home</b></a>
            <a class="mdl-navigation__link" href="{{baseUrl}}/about">About</a>
            <a class="mdl-navigation__link" href="{{baseUrl}}/contact">Contact</a>
        </nav>
    </div>

    <main class="mdl-layout__content" id="main-content">
        <div id="main-container">
            <img id="icon-online" class="icon-status" src="{{precacheUrl}}/icons/online.svg" alt="Online">
            <img id="icon-offline" class="icon-status" src="{{precacheUrl}}/icons/offline.svg" alt="Offline">
            <noscript>
                <p id="js-disabled">Javascript is disabled. PWA features of this application are not available.</p>
            </noscript>
            <!-- Your content goes here -->
        </div>

    </main>
    <footer id="notification-bar" class="mdl-js-snackbar mdl-snackbar" aria-hidden="true">
        <div class="mdl-snackbar__text"></div>
        <button class="mdl-snackbar__action" type="button"></button>
    </footer>
</div>
<script type="text/javascript">
    {{#isLive}}
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker
                .register('{{baseUrl}}/sw.js', {scope: '{{appUrl}}'})
                .then(function(reg) {
                    reg.onupdatefound = function() {
                        notifyAboutNewVersion();
                    };
                    console.log('Service Worker registered with scope '  + reg.scope);
                }, function() {
                    console.log('Service Worker registration failure.');
                });
    }

    function showNotification() {
        var snackbarContainer = document.querySelector('#notification-bar');
        var data = {message: '{{title}} upgraded to the latest version'};
        snackbarContainer.MaterialSnackbar.showSnackbar(data);
    }

    function notifyAboutNewVersion() {
        if (!("Notification" in window)) {
            console.log('Notification API not supported.');
            return;
        }

        // Let's check whether notification permissions have already been granted
        if (Notification.permission === "granted") {
            // If it's okay let's create a notification
            showNotification();
        }

        // Otherwise, we need to ask the user for permission
        else if (Notification.permission !== 'denied') {
            Notification.requestPermission(function (permission) {
                // If the user accepts, let's create a notification
                if (permission === "granted") {
                    showNotification();
                }
            });
        }
    }
    {{/isLive}}

    let cssLoaded = 0;

    function removeInlineStyles() {
        const styleEl = document.getElementsByTagName('style')[0];
        styleEl.parentNode.removeChild(styleEl);
    }

    function addLinkElToHead(src) {
        const link = document.createElement('link');
        link.setAttribute('rel', 'stylesheet');
        link.setAttribute('type', 'text/css');
        link.setAttribute('href', src);
        link.onload = () => {
            debugger;

            cssLoaded++;
            if (cssLoaded === 3) {
                removeInlineStyles();
            }
        }
        document.getElementsByTagName('head')[0].appendChild(link);
    }

    addLinkElToHead('{{precacheUrl}}/css/material.indigo-pink.min.css');
    addLinkElToHead('{{precacheUrl}}/bundle.css');
    addLinkElToHead('https://fonts.googleapis.com/icon?family=Material+Icons');

</script>

</body>
</html>